<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>管理员管理-有点</title>
	<base href="http://www.tours.com/admin/">
<link rel="stylesheet" type="text/css" href="css/css.css" />
<script type="text/javascript" src="js/jquery.min.js"></script>
<!-- <script type="text/javascript" src="js/page.js" ></script> -->
</head>

<body>
<div id="pageAll">
<div class="pageTop">
	<div class="page">
		<img src="img/coin02.png" /><span><a href="{:url('index/main')}">首页</a>&nbsp;-&nbsp;-</span>&nbsp;后台人事管理
	</div>
</div>

<div class="page">
	<!-- user页面样式 -->
	<div class="connoisseur">
		<div class="conform">
				<div class="cfD">
					<input class="userinput" id="u_name" type="text" placeholder="输入用户名" name="accounts"/>&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;
					<input class="userinput vpr" id="u_password" type="password" placeholder="输入用户密码" name="password"/>
					<select name="role_id" id="">
						<option value="0">请选择</option>
						{volist name='rolelist' id='vv'}
						<option value="{$vv.role_id}">{$vv.role_name}</option>
						{/volist}
					</select>
					<button class="userbtn tj" id="register">添加</button>
				</div>
		</div>
		<script>

		</script>
		<!-- user 表格 显示 -->
		<div class="conShow">
			<table border="1" cellspacing="0" cellpadding="0">
				<tr>
					<td width="66px" class="tdColor tdC">序号</td>
					<td width="435px" class="tdColor">会员等级</td>
					<td width="400px" class="tdColor">用户名</td>
					<td width="630px" class="tdColor">最后登录时间</td>
					<td width="130px" class="tdColor">操作</td>
				</tr>
				{volist name='adminlist' id='v'}
				<tr height="40px">
					<td>{$v.admin_id}</td>
					<td>{$v.role_name}</td>
					<td><span class="name">{$v.accounts}</span><input type="text" class="u_name" value="" hidden /></td>
					<td>{$v.last_time}</td>
					<td>
						<a href="javascript:;" class="upd">
							<img class="operation" src="img/update.png">
						</a>
						<img class="operation delban del" src="img/delete.png" id="{$v.admin_id}">
					</td>
				</tr>
				{/volist}
			</table>
			<div class="paging"></div>
		</div>
		<!-- user 表格 显示 end-->
	</div>
	<!-- user页面样式end -->
</div>
	{$adminlist->render()}
</div>
</body>

<script type="text/javascript">
	//管理员删除
        $('.del').click(function () {
            var tk = confirm("是否删除该账号");
            if(tk == false){
                return false;
			}else {
                var admin_id = $(this).attr('id');

                $.ajax({
                    type: "POST",
                    url: "{:url('admin/admin_del')}",
                    data: {admin_id:admin_id},
                    success: function(msg){
                        if(msg == 0){
                            alert('删除成功');
                            location.href="{:url('admin/adminlist')}";
                        }else {
                            alert('删除失败');
                            location.href="{:url('admin/adminlist')}";
                        }
                    }
                });
			}
        });
        //管理员添加
        $('.tj').click(function () {
            var accounts = $('input[name=accounts]').val();
            var password = $('input[name=password]').val();
            var role_id = $('select[name=role_id]').val();

            data = {
                'accounts':accounts,
                'password':password,
                'role_id':role_id
			};
                if(role_id == 0){
                    return alert('请选择角色')
				}
            $.ajax({
                type: "POST",
                url: "{:url('admin/admin_add')}",
                data: data,
                success: function(msg){
					if(msg == 0){
					    alert('用户名不能为空');
					}else if(msg == 1){
					    alert('密码不能为空');
					}else if(msg == 2){
					    alert('添加成功')
						window.location.href="{:url('admin/adminlist')}"
					}else if(msg == 3){
					    alert('添加失败');
                        window.location.href="{:url('admin/adminlist')}"
					}
                }
            });
        });
// 广告弹出框
$(".delban").click(function(){
  $(".banDel").show();
});
$(".close").click(function(){
  $(".banDel").hide();
});
$(".no").click(function(){
  $(".banDel").hide();
});
// 广告弹出框 end
$(document).on("click",".upd",function(){
	$(".name").hide()
	$(".u_name").show()
});
</script>
</html>